# this playbook is used by other playbooks
---
- hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - meta: refresh_inventory

- hosts: masters
  remote_user: "{{ user }}"
  gather_facts: false
  tasks:
    - shell: exit 0
      ignore_errors: true
      register: result

    - add_host:
        name: "{{ inventory_hostname }}"
        group: masters_reachable
      when:
        - result is succeeded

- hosts: workers
  remote_user: "{{ user }}"
  gather_facts: false
  tasks:
    - shell: exit 0
      ignore_errors: true
      register: result

    - add_host:
        name: "{{ inventory_hostname }}"
        group: workers_reachable
      when:
        - result is succeeded

- hosts: localhost
  connection: local
  tasks:
    - debug:
        var: groups['masters_reachable']

    - debug:
        var: groups['workers_reachable']
