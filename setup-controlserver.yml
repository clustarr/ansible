# this playbook is executed on a random host
# ansible-playbook setup-controlserver.yml -k -K
---
- hosts: controlserver
  remote_user: ansible
  tasks:
    - name: create ssh directory
      file:
        path: "/home/ansible/.ssh"
        state: directory
        mode: 0775

    - name: generate openssh keypair
      openssh_keypair:
        path: /home/ansible/.ssh/id_rsa

    - include_role:
        name: clustarr
        tasks_from: ssh

    - include_role:
        name: clustarr
        tasks_from: dnsmasq

    - include_role:
        name: clustarr
        tasks_from: lighttpd

    - include_role:
        name: clustarr
        tasks_from: pxe-install

    - include_role:
        name: clustarr
        tasks_from: docker

    - include_role:
        name: clustarr
        tasks_from: frontend

    - include_role:
        name: clustarr
        tasks_from: ansible

    - include_role:
        name: clustarr
        tasks_from: rke-install

    - include_role:
        name: clustarr
        tasks_from: kubectl

    - name: download clustarr ansible repo
      git:
        repo: https://github.com/clustarr/ansible.git
        dest: /home/ansible/ansible
